<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Story Config Editor</title>
    <!-- CSS Components -->
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/panels.css" />
    <link rel="stylesheet" href="css/forms.css" />
    <link rel="stylesheet" href="css/preview.css" />
    <link rel="stylesheet" href="css/scenes.css" />
    <link rel="stylesheet" href="css/assets.css" />
    <link rel="stylesheet" href="css/modal.css" />
    <link rel="stylesheet" href="css/node-editor.css" />
    <style>
      /* Enhanced styles for project settings and compact controls */
      .project-settings-drawer {
        position: fixed;
        top: 0;
        right: -400px;
        width: 380px;
        height: 100vh;
        background: #2c3e50;
        border-left: 2px solid #34495e;
        z-index: 2500;
        transition: right 0.3s ease;
        overflow-y: auto;
      }

      .project-settings-drawer.open {
        right: 0;
      }

      .project-settings-section {
        padding: 20px;
        border-bottom: 1px solid #34495e;
      }

      .section-title {
        color: #3498db;
        font-size: 16px;
        margin-bottom: 15px;
        border-bottom: 1px solid #34495e;
        padding-bottom: 5px;
      }

      .compact-slider-group {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        gap: 8px;
      }

      .compact-slider-group label {
        min-width: 50px;
        font-size: 12px;
        color: #bdc3c7;
      }

      .compact-slider-container {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1;
      }

      .compact-slider {
        flex: 1;
        height: 4px;
      }

      .compact-slider-value {
        min-width: 45px;
        font-size: 11px;
        color: #ecf0f1;
        text-align: right;
      }

      .controls-row {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .choice-position-item.compact {
        margin-bottom: 15px;
        padding: 10px;
        background: rgba(52, 73, 94, 0.3);
        border-radius: 4px;
      }

      .choice-position-header h5 {
        font-size: 13px;
        margin: 0;
        color: #ecf0f1;
      }

      .btn-tiny {
        padding: 2px 6px;
        font-size: 10px;
        min-width: auto;
      }

      .properties-section {
        padding: 6px;
        background: rgba(52, 73, 94, 0.3);
        border-radius: 6px;
        border: 1px solid #34495e;
      }

      .properties-grid {
        display: flex;
        gap: 6px;
      }

      .effect-indicator {
        background: #e74c3c;
        color: white;
        padding: 2px 4px;
        border-radius: 3px;
        font-size: 10px;
        margin-left: 5px;
      }

      .color-input-group {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
      }

      .color-input-group label {
        min-width: 120px;
        font-size: 12px;
      }

      .color-input-group input[type="color"] {
        width: 40px;
        height: 30px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .dimensions-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .timing-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
    </style>
  </head>
  <body>
    <div id="editor-container">
      <!-- Selected Object Panel -->
      <div class="selected-object-panel" id="selected-object-panel">
        <div id="object-properties" class="object-properties"></div>
      </div>

      <!-- Main Editor Area -->
      <div class="editor-main">
        <!-- Left Panel: Scene Properties + Assets -->
        <div class="left-panel">
          <!-- Assets -->
          <div class="panel-section asset-panels">
            <div class="asset-section">
              <div class="asset-drop-zone" id="background-drop-zone">
                <div class="drop-zone-visual">
                  <div class="drop-zone-icon">
                    Backgrounds: Click of drag here
                  </div>
                </div>
                <div id="background-list" class="asset-list"></div>
              </div>
            </div>
            <div class="asset-section">
              <div class="asset-drop-zone" id="object-drop-zone">
                <div class="drop-zone-visual">
                  <div class="drop-zone-icon">Objects: Click of drag here</div>
                </div>
                <div id="object-list" class="asset-list"></div>
              </div>
            </div>
            <p class="drag-instructions">
              Adding objects: Drag them directly from the library to the scene
            </p>
          </div>
        </div>

        <!-- Project Settings Drawer -->
        <div id="project-settings-drawer" class="project-settings-drawer">
          <div class="drawer-header">
            <h4>Project Settings</h4>
            <button class="drawer-close" id="close-project-settings-drawer">
              &times;
            </button>
          </div>
          <div class="drawer-content">
            <!-- Scene Dimensions -->
            <div class="project-settings-section">
              <h4 class="section-title">Scene Dimensions</h4>
              <div class="dimensions-grid">
                <div class="slider-group">
                  <label>Width:</label>
                  <div class="slider-container">
                    <input
                      type="range"
                      id="scene-width"
                      min="480"
                      max="1920"
                      step="10"
                      value="960"
                    />
                    <span class="slider-value" id="scene-width-value"
                      >960px</span
                    >
                  </div>
                </div>
                <div class="slider-group">
                  <label>Height:</label>
                  <div class="slider-container">
                    <input
                      type="range"
                      id="scene-height"
                      min="360"
                      max="1080"
                      step="10"
                      value="720"
                    />
                    <span class="slider-value" id="scene-height-value"
                      >720px</span
                    >
                  </div>
                </div>
              </div>
              <button
                class="btn btn-small btn-secondary"
                id="reset-scene-dimensions"
              >
                Reset to Default
              </button>
            </div>

            <!-- Button Colors -->
            <div class="project-settings-section">
              <h4 class="section-title">Button Colors</h4>
              <div class="color-section">
                <h5>Choice Buttons</h5>
                <div class="color-input-group">
                  <label>Background:</label>
                  <input type="color" id="choice-button-bg" value="#e74c3c" />
                </div>
                <div class="color-input-group">
                  <label>Background Hover:</label>
                  <input
                    type="color"
                    id="choice-button-bg-hover"
                    value="#c0392b"
                  />
                </div>
                <div class="color-input-group">
                  <label>Text Color:</label>
                  <input type="color" id="choice-button-text" value="#ffffff" />
                </div>
              </div>
              <div class="color-section">
                <h5>Continue Buttons</h5>
                <div class="color-input-group">
                  <label>Background:</label>
                  <input type="color" id="continue-button-bg" value="#3498db" />
                </div>
                <div class="color-input-group">
                  <label>Background Hover:</label>
                  <input
                    type="color"
                    id="continue-button-bg-hover"
                    value="#2980b9"
                  />
                </div>
                <div class="color-input-group">
                  <label>Text Color:</label>
                  <input
                    type="color"
                    id="continue-button-text"
                    value="#ffffff"
                  />
                </div>
              </div>
              <button
                class="btn btn-small btn-secondary"
                id="reset-button-colors"
              >
                Reset to Default
              </button>
            </div>

            <!-- Animation Timing -->
            <div class="project-settings-section">
              <h4 class="section-title">Default Animation Timing</h4>
              <div class="timing-grid">
                <div class="slider-group">
                  <label>Duration:</label>
                  <div class="slider-container">
                    <input
                      type="range"
                      id="animation-duration"
                      min="100"
                      max="5000"
                      step="100"
                      value="1000"
                    />
                    <span class="slider-value" id="animation-duration-value"
                      >1000ms</span
                    >
                  </div>
                </div>
                <div class="slider-group">
                  <label>Delay:</label>
                  <div class="slider-container">
                    <input
                      type="range"
                      id="animation-delay"
                      min="0"
                      max="3000"
                      step="100"
                      value="0"
                    />
                    <span class="slider-value" id="animation-delay-value"
                      >0ms</span
                    >
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label>Easing:</label>
                <select id="animation-easing">
                  <option value="ease">Ease</option>
                  <option value="ease-in">Ease In</option>
                  <option value="ease-out">Ease Out</option>
                  <option value="ease-in-out" selected>Ease In-Out</option>
                  <option value="linear">Linear</option>
                </select>
              </div>
              <button
                class="btn btn-small btn-secondary"
                id="reset-animation-timing"
              >
                Reset to Default
              </button>
            </div>
          </div>
        </div>

        <!-- Effect Controls Drawer -->
        <div id="effect-controls-drawer" class="effect-controls-drawer">
          <div class="drawer-header">
            <h4>Effect Settings</h4>
            <button class="drawer-close" id="close-effect-drawer">
              &times;
            </button>
          </div>
          <div class="drawer-content" id="effect-drawer-content">
            <!-- Effect controls will be populated here -->
          </div>
        </div>

        <!-- UI Positioning Drawer -->
        <div id="ui-positioning-drawer" class="ui-positioning-drawer">
          <div class="drawer-header">
            <h4>UI Positioning</h4>
            <button class="drawer-close" id="close-ui-positioning-drawer">
              &times;
            </button>
          </div>
          <div class="drawer-content" id="ui-positioning-drawer-content">
            <!-- Default UI Position Controls -->
            <div class="drawer-section">
              <div class="default-position-controls">
                <div class="default-position-group">
                  <h4>Default Positions</h4>
                  <div class="compact-controls-grid">
                    <div class="compact-slider-group">
                      <label>Text X:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-text-pos-x"
                          min="0"
                          max="100"
                          step="0.1"
                          value="50"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-text-pos-x-value"
                          >50.0%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Text Y:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-text-pos-y"
                          min="0"
                          max="100"
                          step="0.1"
                          value="85"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-text-pos-y-value"
                          >85.0%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Text W:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-text-width"
                          min="10"
                          max="100"
                          step="1"
                          value="80"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-text-width-value"
                          >80%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Btn X:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-buttons-pos-x"
                          min="0"
                          max="100"
                          step="0.1"
                          value="80"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-buttons-pos-x-value"
                          >80.0%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Btn Y:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-buttons-pos-y"
                          min="0"
                          max="100"
                          step="0.1"
                          value="85"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-buttons-pos-y-value"
                          >85.0%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Btn W:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-buttons-width"
                          min="10"
                          max="100"
                          step="1"
                          value="40"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-buttons-width-value"
                          >40%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Choice X:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-choice-pos-x"
                          min="0"
                          max="100"
                          step="0.1"
                          value="80"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-choice-pos-x-value"
                          >80.0%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Choice Y:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-choice-pos-y"
                          min="0"
                          max="100"
                          step="0.1"
                          value="85"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-choice-pos-y-value"
                          >85.0%</span
                        >
                      </div>
                    </div>
                    <div class="compact-slider-group">
                      <label>Choice W:</label>
                      <div class="compact-slider-container">
                        <input
                          type="range"
                          id="default-choice-width"
                          min="10"
                          max="100"
                          step="1"
                          value="40"
                          class="compact-slider"
                        />
                        <span
                          class="compact-slider-value"
                          id="default-choice-width-value"
                          >40%</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Current Scene UI Position Controls -->
            <div class="drawer-section">
              <div class="ui-position-controls">
                <div class="ui-position-group">
                  <div class="position-group-header">
                    <h4>Current Scene</h4>
                    <button
                      class="btn btn-small btn-reset"
                      id="reset-buttons-position"
                    >
                      Reset Buttons
                    </button>
                  </div>
                  <div class="compact-slider-group">
                    <label>Text X:</label>
                    <div class="compact-slider-container">
                      <input
                        type="range"
                        id="text-pos-x"
                        min="0"
                        max="100"
                        step="0.1"
                        value="50"
                        class="compact-slider"
                      />
                      <span class="compact-slider-value" id="text-pos-x-value"
                        >50.0%</span
                      >
                    </div>
                  </div>
                  <div class="compact-slider-group">
                    <label>Text Y:</label>
                    <div class="compact-slider-container">
                      <input
                        type="range"
                        id="text-pos-y"
                        min="0"
                        max="100"
                        step="0.1"
                        value="85"
                        class="compact-slider"
                      />
                      <span class="compact-slider-value" id="text-pos-y-value"
                        >85.0%</span
                      >
                    </div>
                  </div>
                  <div class="compact-slider-group">
                    <label>Btn X:</label>
                    <div class="compact-slider-container">
                      <input
                        type="range"
                        id="buttons-pos-x"
                        min="0"
                        max="100"
                        step="0.1"
                        value="80"
                        class="compact-slider"
                      />
                      <span
                        class="compact-slider-value"
                        id="buttons-pos-x-value"
                        >80.0%</span
                      >
                    </div>
                  </div>
                  <div class="compact-slider-group">
                    <label>Btn Y:</label>
                    <div class="compact-slider-container">
                      <input
                        type="range"
                        id="buttons-pos-y"
                        min="0"
                        max="100"
                        step="0.1"
                        value="85"
                        class="compact-slider"
                      />
                      <span
                        class="compact-slider-value"
                        id="buttons-pos-y-value"
                        >85.0%</span
                      >
                    </div>
                  </div>
                </div>

                <!-- Reset All Button -->
                <div class="ui-position-group">
                  <button
                    class="btn btn-primary btn-full-width"
                    id="reset-all-positions"
                  >
                    Reset All UI Positions
                  </button>
                </div>
              </div>
            </div>

            <!-- Choice Positions -->
            <div
              class="drawer-section"
              id="choice-positions-section-drawer"
              style="display: none"
            >
              <div
                id="choice-positions-list"
                class="choice-positions-list"
              ></div>
            </div>
          </div>
        </div>

        <!-- Center Panel: Scene Preview -->
        <div class="center-panel">
          <div class="scene-preview" id="scene-preview">
            <div class="preview-scene" id="preview-scene">
              <div class="drop-zone">Drop objects here or click to place</div>
            </div>
          </div>
        </div>

        <!-- Right Panel: Content & Choices -->
        <div class="right-panel">
          <div class="header-controls">
            <button id="new-scenario" class="btn btn-primary">
              New Scenario
            </button>
            <button id="load-project" class="btn btn-secondary">
              Load Project
            </button>
            <button id="save-project" class="btn btn-success">
              Save Project
            </button>
            <button id="open-project-settings" class="btn btn-info">
              <span class="btn-icon">⚙️</span>
              Project Settings
            </button>
            <button id="export-story" class="btn btn-export">
              <span class="btn-icon">📦</span>
              Export Story
            </button>
            <div class="auto-save-status" id="auto-save-status">
              Auto-save: <span id="auto-save-indicator">Ready</span>
            </div>
            <input
              type="file"
              id="file-input"
              accept=".json"
              style="display: none"
            />
            <input
              type="file"
              id="asset-file-input"
              accept="image/*"
              multiple
              style="display: none"
            />
          </div>

          <div class="panel-section info-panel">
            <div class="form-group">
              <label>Scene:</label>
              <div class="scene-id-name-group">
                <span id="scene-id-display" class="scene-id-display">1:</span>
                <input
                  type="text"
                  id="scene-name"
                  placeholder="Scene Name"
                  class="scene-name-input"
                />
              </div>
            </div>
            <div class="form-group">
              <label>Type:</label>
              <select id="scene-type">
                <option value="choice">Choice</option>
                <option value="image">Image</option>
              </select>
            </div>
            <div class="form-group">
              <label>Background:</label>
              <select id="scene-background">
                <option value="">No Background</option>
              </select>
            </div>
            <div class="form-group" id="next-scene-group">
              <label>Next Scene:</label>
              <select id="next-scene">
                <option value="">Select Scene</option>
                <option value="null">End</option>
              </select>
            </div>
          </div>

          <!-- UI Positioning Button -->
          <div class="panel-section">
            <button
              id="open-ui-positioning"
              class="btn btn-primary btn-full-width"
            >
              <span class="btn-icon">⚙️</span>
              UI Positioning
            </button>
          </div>

          <!-- Overlay Properties -->
          <div class="panel-section">
            <div id="overlay-controls" class="overlay-controls">
              <div class="form-group">
                <label>
                  <input type="checkbox" id="overlay-enabled" /> Enable Overlay
                </label>
              </div>
              <div class="form-group">
                <input type="color" id="overlay-color" value="#000000" />
              </div>
              <div class="slider-group">
                <label>Opacity:</label>
                <div class="slider-container">
                  <input
                    type="range"
                    id="overlay-opacity"
                    min="0"
                    max="1"
                    step="0.1"
                    value="0.5"
                  />
                  <span class="slider-value" id="overlay-opacity-value"
                    >0.5</span
                  >
                </div>
              </div>
              <div class="slider-group">
                <label>Z-Index:</label>
                <div class="slider-container">
                  <input
                    type="range"
                    id="overlay-zindex"
                    min="1"
                    max="100"
                    step="1"
                    value="45"
                  />
                  <span class="slider-value" id="overlay-zindex-value">45</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Scene Content -->
          <div class="panel-section">
            <h3>Scene Content</h3>
            <div class="form-group">
              <label>Content:</label>
              <textarea
                id="scene-content"
                placeholder="Scene content/text"
              ></textarea>
            </div>

            <!-- Scene Objects List -->
            <div class="scene-objects-section">
              <h4>Objects in Scene</h4>
              <div id="scene-objects-list" class="scene-objects-list"></div>
            </div>
          </div>

          <!-- Choices -->
          <div class="panel-section" id="choices-section">
            <button id="add-choice" class="btn btn-small">Add Choice</button>
            <div id="choices-list" class="choices-list"></div>
          </div>
        </div>
      </div>

      <!-- Bottom Panel: Scenes -->
      <div class="bottom-panel">
        <div class="scene-controls">
          <button id="add-scene" class="btn btn-small">Add Scene</button>
          <button id="duplicate-scene" class="btn btn-small">Duplicate</button>
          <button id="delete-scene" class="btn btn-small btn-danger">
            Delete
          </button>
          <button
            id="open-node-editor"
            class="btn btn-small node-editor-button"
          >
            <span class="node-editor-icon">🕸️</span>
            Node Editor
          </button>
        </div>
        <div id="scene-list-horizontal" class="scene-list-horizontal"></div>
      </div>
    </div>

    <!-- Modal for warnings -->
    <div id="warning-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Warning</h3>
        <p id="warning-message"></p>
      </div>
    </div>

    <!-- Modal for new scenario confirmation -->
    <div id="new-scenario-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="new-scenario-close">&times;</span>
        <h3>New Scenario</h3>
        <p id="new-scenario-message">
          Are you sure you want to create a new scenario? This will clear all
          current work and cannot be undone.
        </p>
        <div class="modal-buttons">
          <button id="confirm-new-scenario" class="btn btn-danger">
            Yes, Create New Scenario
          </button>
          <button id="cancel-new-scenario" class="btn btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Modal for reset all positions confirmation -->
    <div id="reset-all-positions-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="reset-all-positions-close">&times;</span>
        <h3>Reset All UI Positions</h3>
        <p id="reset-all-positions-message">
          Are you sure you want to reset all UI positions to defaults? This will
          affect
          <strong>ALL scenes</strong> in your project and reset:
        </p>
        <ul style="margin: 10px 0; padding-left: 20px; color: #ecf0f1">
          <li>Text content positions</li>
          <li>Button container positions</li>
          <li>All individual choice positions</li>
        </ul>
        <p style="color: #e74c3c; font-weight: bold">
          This action cannot be undone and will affect every scene in your
          project.
        </p>
        <div class="modal-buttons">
          <button id="confirm-reset-all-positions" class="btn btn-danger">
            Yes, Reset All Positions
          </button>
          <button id="cancel-reset-all-positions" class="btn btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Modal for export filename -->
    <div id="export-filename-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="export-filename-close">&times;</span>
        <h3>Export Interactive Story</h3>
        <p>Choose a filename for your exported story:</p>
        <div class="form-group">
          <input
            type="text"
            id="export-filename-input"
            placeholder="my-story"
          />
          <span>.html</span>
        </div>
        <div class="modal-buttons">
          <button id="confirm-export" class="btn btn-success">
            Export Story
          </button>
          <button id="cancel-export" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- JavaScript Components -->
    <script src="js/utils.js"></script>
    <script src="js/project-manager.js"></script>
    <script src="js/asset-manager.js"></script>
    <script src="js/scene-manager.js"></script>
    <script src="js/preview-context-menu-manager.js"></script>
    <script src="js/preview-interaction-manager.js"></script>
    <script src="js/preview-renderer.js"></script>
    <script src="js/preview-manager.js"></script>
    <!-- UI Manager Components -->
    <script src="js/modal-manager.js"></script>
    <script src="js/position-manager.js"></script>
    <script src="js/object-properties-manager.js"></script>
    <script src="js/effect-manager.js"></script>
    <script src="js/scene-ui-manager.js"></script>
    <script src="js/ui-manager.js"></script>
    <script src="js/node-connection.js"></script>
    <script src="js/node-manager.js"></script>
    <script src="js/node-renderer.js"></script>
    <script src="js/node-editor.js"></script>

    <script src="js/project-handler.js"></script>
    <script src="js/object-controller.js"></script>
    <script src="js/scene-controller.js"></script>

    <script src="js/scene-preview-manager.js"></script>

    <script src="js/editor.js"></script>
  </body>
</html>
