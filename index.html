<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Furry Merge Farm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="variables.css" />
    <link rel="stylesheet" href="base.css" />
    <link rel="stylesheet" href="components.css" />
    <link rel="stylesheet" href="grid.css" />
    <link rel="stylesheet" href="animations.css" />
    <link rel="stylesheet" href="responsive.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="loading.css" />
    <link rel="stylesheet" href="credits-gallery.css" />
  </head>
  <body>
    <div id="loadingScreen" class="loading-screen">
      <div class="loading-content">
        <div class="loading-logo">
          <img
            src="images/company-logo.png"
            alt="Company Logo"
            class="logo-image"
          />
        </div>
        <div id="loadingText" class="loading-text">
          Loading Furry Merge Farm...
        </div>
        <div class="loading-bar-container">
          <div class="loading-bar-background">
            <div id="loadingBar" class="loading-bar" style="width: 0%">
              <div class="loading-bar-shine"></div>
              <div class="loading-bar-glow"></div>
            </div>
            <div class="loading-bar-particles">
              <div class="particle particle-1"></div>
              <div class="particle particle-2"></div>
              <div class="particle particle-3"></div>
              <div class="particle particle-4"></div>
              <div class="particle particle-5"></div>
            </div>
          </div>
        </div>
        <div id="loadingPercentage" class="loading-percentage">0%</div>
        <div class="loading-animals">
          <div class="loading-animal loading-egg">ü•ö</div>
          <div class="loading-animal loading-cat">üê±</div>
          <div class="loading-animal loading-panda">üêº</div>
          <div class="loading-animal loading-bird">ü¶Ö</div>
        </div>
      </div>
    </div>

    <div id="gameContainer"></div>

    <script src="config.js"></script>
    <script src="credits-data.js"></script>
    <script src="loading.js"></script>
    <script>
      // Utility manager needs to be loaded first before other managers
      const utilityManager = {
        eventListenerRegistry: new Map(),
        intervalRegistry: new Map(),
        timeoutRegistry: new Map(),

        addEventListener(element, event, handler, identifier) {
          element.addEventListener(event, handler);

          if (!this.eventListenerRegistry.has(identifier)) {
            this.eventListenerRegistry.set(identifier, []);
          }
          this.eventListenerRegistry.get(identifier).push({
            element,
            event,
            handler,
          });
        },

        removeEventListeners(identifier) {
          const listeners = this.eventListenerRegistry.get(identifier);
          if (listeners) {
            listeners.forEach(({ element, event, handler }) => {
              element.removeEventListener(event, handler);
            });
            this.eventListenerRegistry.delete(identifier);
          }
        },

        setInterval(callback, delay, identifier) {
          const intervalId = setInterval(callback, delay);
          this.intervalRegistry.set(identifier, intervalId);
          return intervalId;
        },

        clearInterval(identifier) {
          const intervalId = this.intervalRegistry.get(identifier);
          if (intervalId) {
            clearInterval(intervalId);
            this.intervalRegistry.delete(identifier);
          }
        },

        setTimeout(callback, delay, identifier) {
          const timeoutId = setTimeout(() => {
            callback();
            this.timeoutRegistry.delete(identifier);
          }, delay);
          this.timeoutRegistry.set(identifier, timeoutId);
          return timeoutId;
        },

        clearTimeout(identifier) {
          const timeoutId = this.timeoutRegistry.get(identifier);
          if (timeoutId) {
            clearTimeout(timeoutId);
            this.timeoutRegistry.delete(identifier);
          }
        },

        cleanup() {
          this.eventListenerRegistry.forEach((listeners) => {
            listeners.forEach(({ element, event, handler }) => {
              element.removeEventListener(event, handler);
            });
          });
          this.eventListenerRegistry.clear();

          this.intervalRegistry.forEach((intervalId) =>
            clearInterval(intervalId)
          );
          this.intervalRegistry.clear();

          this.timeoutRegistry.forEach((timeoutId) => clearTimeout(timeoutId));
          this.timeoutRegistry.clear();
        },

        createElement(tag, className, innerHTML = "") {
          const element = document.createElement(tag);
          if (className) element.className = className;
          if (innerHTML) element.innerHTML = innerHTML;
          return element;
        },

        generateButtonHTML(
          id,
          className,
          text,
          iconSrc = null,
          hidden = false
        ) {
          const hiddenClass = hidden ? "hidden" : "";
          const icon = iconSrc
            ? `<img src="${iconSrc}" alt="${text}" class="inline-animal-icon" />`
            : "";
          return `
      <button id="${id}" class="${className} ${hiddenClass}">
        <span>${text}</span>${icon}
      </button>
    `;
        },

        createTooltip(content, targetElement, id) {
          const existing = document.getElementById(id);
          if (existing) existing.remove();

          const tooltip = this.createElement("div", "tooltip-fixed", content);
          tooltip.id = id;
          document.body.appendChild(tooltip);

          const targetRect = targetElement.getBoundingClientRect();
          const tooltipRect = tooltip.getBoundingClientRect();

          let left = targetRect.left - tooltipRect.width - 10;
          let top =
            targetRect.top + (targetRect.height - tooltipRect.height) / 2;

          const viewportWidth = window.innerWidth;
          const viewportHeight = window.innerHeight;

          if (left < 10) {
            left = targetRect.right + 10;
          } else if (left + tooltipRect.width > viewportWidth - 10) {
            left = viewportWidth - tooltipRect.width - 10;
          }

          if (top < 10) {
            top = 10;
          } else if (top + tooltipRect.height > viewportHeight - 10) {
            top = viewportHeight - tooltipRect.height - 10;
          }

          tooltip.style.left = `${left}px`;
          tooltip.style.top = `${top}px`;

          return tooltip;
        },

        removeTooltip(id) {
          const tooltip = document.getElementById(id);
          if (tooltip) tooltip.remove();
        },

        clamp(value, min, max) {
          return Math.max(min, Math.min(max, value));
        },

        formatNumber(num) {
          return new Intl.NumberFormat().format(num);
        },

        randomBetween(min, max) {
          return Math.random() * (max - min) + min;
        },

        removeElementsByClass(className) {
          const elements = document.querySelectorAll(`.${className}`);
          elements.forEach((element) => element.remove());
        },

        addScreenShake() {
          document.body.classList.add("screen-shake");
          this.setTimeout(
            () => document.body.classList.remove("screen-shake"),
            500,
            "screenShake"
          );
        },
      };
    </script>
    <script src="audiomanager.js"></script>
    <script src="achievementmanager.js"></script>
    <script src="savemanager.js"></script>
    <script src="gridmanager.js"></script>
    <script src="coopmanager.js"></script>
    <script src="slaughterhousemanager.js"></script>
    <script src="eventmanager.js"></script>
    <script src="app.js"></script>
  </body>
</html>
